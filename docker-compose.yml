version: '2'

services:
  db:
    image: postgres

  web:
    build: web/
    environment:
      SECRET_KEY: "76c076963326c4787b4babd5452e17b7"
      DEBUG: "True"
      STATIC_ROOT: '/code/app/song_snapchat/static/'
      MEDIA_ROOT: '/code/app/media/'
      ALLOWED_HOSTS: "*"
      DATABASES: "{'default': {'ENGINE': 'django.db.backends.sqlite3', 'NAME': '/code/app/db.sqlite3',}}"
      SITE_NAME_HUMAN: "Snapchat for songs"
    command: bash -c "python3 /code/app/manage.py migrate && python3 /code/app/manage.py runserver 0.0.0.0:8000"
    volumes:
      - ./web:/code
    ports:
      - "8000:8000"
    depends_on:
      - db

  nginx:
    image: "nginx:latest"
    volumes:
    - static:/static/
    ports:
    - 8080:8080
    environment:
      PASS_TO: "http://ec2-18-185-125-152.eu-central-1.compute.amazonaws.com"
    depends_on:
    - web
